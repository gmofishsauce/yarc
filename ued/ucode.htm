<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>YARC Microcode Definition</title>

    <!-- styles for all the controls -->
    <link rel='stylesheet' id='core-theme-base-css' href='./ucode.css' type='text/css' media='all' />

    <!-- script code is out of line -->
    <script type="text/javascript" src="./ucode.js"></script>
    <script>

    // draw block diagram

	function pos(id, x, y) {
		gebi(id).style.left = `${x}px`;
		gebi(id).style.top = `${y}px`;
	}

	function xCtrOf(id, x) {
		let box = gebi(id).getBoundingClientRect();
		//console.log(box);
		//console.log("box.(x, y) = (${box.x}, ${box.y})");
		return x - box.width / 2;
	}

	function drawGrid(ctx, wd, ht) {
	  for (let row = 0; row < ht; row += 50) {
		ctx.beginPath();
		ctx.moveTo(0, row); 
		ctx.lineTo(wd, row);
		ctx.closePath();
		ctx.stroke();
	  }
	  for (let col = 0; col < wd; col += 50) {
		ctx.beginPath();
		ctx.moveTo(col, 0); 
		ctx.lineTo(col, ht);
		ctx.closePath();
		ctx.stroke();
	  }
	}

    function redraw() {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
	  ctx.strokeStyle = "rgb(0, 0, 0)";
	  ctx.lineWidth = 0.5;

	  let wd = parseInt(canvas.width);
	  let ht = parseInt(canvas.height);
	  drawGrid(ctx, wd, ht);

      ctx.fillStyle = "rgb(224, 224, 224)";
      ctx.fillRect(50, 100, 150, 100); // src1/bank1
      ctx.fillRect(250, 100, 150, 100); // src1/bank2
	  ctx.fillRect(100, 250, 250, 50); // alu

	  pos("src1",          xCtrOf("src1", 125),    100);
	  pos("src2",          xCtrOf("src2", 325),    100);
	  pos("dst",           425,                    150);
	  pos("alu_ctl",       xCtrOf("alu_ctl", 225), 250);
	  pos("acn",           375,                    265);
	  pos("alu_load_hold", 250,                    215);

	  pos("alu_load_flgs", 1000, 100);
	  pos("sysdata_src", 1000, 120);
	  pos("reg_in_mux", 1000, 140);
	  pos("rcw_cross", 1000, 160);
	  pos("sysaddr_src", 1000, 180);
	  pos("dst_wr_en", 1000, 200);
	  pos("rw", 1000, 220);
	  pos("m16_en", 1000, 240);
	  pos("load_ir", 1000, 260);
	  pos("rcw_ir_uc", 1000, 280);
	  pos("carry_en", 1000, 300);
	  pos("load_flgs_mux", 1000, 320);
	  pos("acn_ir_uc", 1000, 340);
	  pos("ir0_en", 1000, 360);
    }

    </script>

  </head>

  <body id="pageBody">
    <H1>YARC Microcode Editor</H1>

    <form name="controls" id="controls" action="/this/form/cannot/be/submitted">

      <canvas id="canvas" width="1350" height="500"></canvas>

      <div name="glasspane" id="glasspane">
      <label class="ucc" id="src1">src1
    	<select id="k3-src1-3-6" onchange="collect()">
    	  <option value="0">r0</option>
    	  <option value="1">r1</option>
    	  <option value="2">r2</option>
    	  <option value="3" selected>r3</option>
    	</select>
      </label>
      <label class="ucc" id="src2">src2
    	<select id="k3-src2-7-3" onchange="collect()">
    	  <option value="0">r0</option>
    	  <option value="1">r1</option>
    	  <option value="2">r2</option>
    	  <option value="3">r3</option>
    	  <option value="4">const_p2</option>
    	  <option value="5">const_p1</option>
    	  <option value="6">const_n2</option>
    	  <option value="7" selected>const_n1</option>
    	</select> &nbsp;
      </label>
      <label class="ucc" id="dst">dst
		<select id="k3-dst-7-0" onchange="collect()">
		  <option value="0">r0</option>
		  <option value="1">r1</option>
		  <option value="2">r2</option>
		  <option value="3">r3</option>
		  <option value="4">cond_r0</option>
		  <option value="5">cond_r1</option>
		  <option value="6">cond_r2</option>
		  <option value="7" selected>cond_r3</option>
		</select>
      </label>
      <label class="ucc" id="acn">acn
	    <select id="k2-acn-15-4" onchange="collect()">
		  <option value="0">alu_add</option>
		  <option value="1">alu_sub</option>
		  <option value="2">alu_rsub</option>
		  <option value="3">alu_adc</option>
		  <option value="4">alu_sbb</option>
		  <option value="5">alu_rsbb</option>
		  <option value="6">alu_neg</option>
		  <option value="7">alu_cmp</option>
		  <option value="8">alu_nand</option>
		  <option value="9">alu_or</option>
		  <option value="10">alu_xor</option>
		  <option value="11">alu_not</option>
		  <option value="12">alu_rot</option>
		  <option value="13">alu_shf</option>
		  <option value="14">alu_0x0E</option>
		  <option value="15" selected>alu_pass</option>
		</select>
      </label>
      <label class="ucc" id="alu_ctl">alu_ctl
	    <select id="k2-alu_ctl-3-2" onchange="collect()">
		  <option value="0">alu_phi1</option>
		  <option value="1">alu_phi2</option>
		  <option value="2">alu_in</option>
		  <option value="3" selected>alu_none</option>
		</select>
      </label>
      <label class="ucc" id="alu_load_hold">alu_load_hold
		<select id="k2-alu_load_hold-1-1" onchange="collect()">
		  <option value="0">yes</option>
		  <option value="1" selected>no</option>
		</select>
	  </label>
      <label class="ucc" id="alu_load_flgs">alu_load_flgs
		<select id="k2-alu_load_flgs-1-0" onchange="collect()">
		  <option value="0">yes</option>
		  <option value="1" selected>no</option>
		</select>
	  </label>
      <label class="ucc" id="sysdata_src">sysdata_src
    	<select id="k1-sysdata_src-7-5" onchange="collect()">
    	  <option value="0">bus_gr</option>
    	  <option value="1">bus_addr</option>
    	  <option value="2">bus_ir</option>
    	  <option value="3">bus_f</option>
    	  <option value="4">bus_mem</option>
    	  <option value="5">bus_tbd_5</option>
    	  <option value="6">bus_tbd_6</option>
    	  <option value="7" selected>bus_none</option>
    	</select>
      </label>
      <label class="ucc" id="reg_in_mux">reg_in_mux
    	<select id="k1-reg_in_mux-1-4" onchange="collect()">
    	  <option value="0">from_alu</option>
    	  <option value="1" selected>from_bus</option>
    	</select>
      </label>
      <label class="ucc" id="rcw_cross">rcw_cross
		<select id="k1-rcw_cross-1-3" onchange="collect()">
		  <option value="0">rcw_cross</option>
		  <option value="1" selected>rcw_normal</option>
		</select>
      </label>
      <label class="ucc" id="sysaddr_src">sysaddr_src
		<select id="k1-sysaddr_src-3-1" onchange="collect()">
		  <option value="0">addr_op</option>
		  <option value="1">addr_ix</option>
		  <option value="2">addr_alu</option>
		  <option value="3" selected>addr_gr</option>
		</select>
      </label>
      <label class="ucc" id="dst_wr_en">dst_wr_en
		<select id="k1-dst_wr_en-1-0" onchange="collect()">
		  <option value="0">yes</option>
		  <option value="1" selected>no</option>
		</select>
      </label>
      <label class="ucc" id="rw">rw
    	<select id="k0-rw-1-7" onchange="collect()" onchange="collect()">
    	  <option value="0">write</option>
    	  <option value="1" selected>read</option>
    	</select>
      </label>
      <label class="ucc" id="m16_en">m16_en
    	<select id="k0-m16_en-1-6" onchange="collect()">
    	  <option value="0">bit16</option>
    	  <option value="1" selected>bit8</option>
    	</select>
      </label>
      <label class="ucc" id="load_ir">load_ir
    	<select id="k0-load_ir-1-5" onchange="collect()">
    	  <option value="0">yes</option>
    	  <option value="1" selected>no</option>
    	</select>
      </label>
      <label class="ucc" id="rcw_ir_uc">rcw_ir_uc
    	<select id="k0-rcw_ir_uc-1-4" onchange="collect()">
    	  <option value="0">rcw_from_ir</option>
    	  <option value="1" selected>rcw_from_uc</option>
    	</select>
      </label>
      <label class="ucc" id="carry_en">carry_en
        <select id="k0-carry_en-1-3" onchange="collect()">
    	  <option value="0">force_low</option>
    	  <option value="1" selected>pass</option>
    	</select>
      </label>
      <label class="ucc" id="load_flgs_mux">load_flgs_mux
    	<select id="k0-load_flgs_mux-1-2" onchange="collect()">
    	  <option value="0">from_alu</option>
    	  <option value="1" selected>from_bus</option>
    	</select>
      </label>
      <label class="ucc" id="acn_ir_uc">acn_ir_uc
    	<select id="k0-acn_ir_uc-1-1" onchange="collect()">
    	  <option value="0">acn_from_ir</option>
    	  <option value="1" selected>acn_from_uc</option>
    	</select>
      </label>
      <label class="ucc" id="ir0_en">ir0_en
    	<select id="k0-ir0_en-1-0" onchange="collect()">
    	  <option value="0">force_low</option>
    	  <option value="1" selected>pass</option>
    	</select>
      </label>
	  </div>
    </form>
    <br>
    <div id=microcode>
      <p>
    	<pre name="mcodeText" id="mcodeText" style="margin: 20px;"></pre>
      </p>
    </div>
  </body>
</html>
